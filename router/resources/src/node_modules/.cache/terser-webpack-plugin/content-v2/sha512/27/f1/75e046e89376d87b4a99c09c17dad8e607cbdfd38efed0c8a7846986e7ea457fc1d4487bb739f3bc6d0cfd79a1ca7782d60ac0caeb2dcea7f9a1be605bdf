{"code":"var app=function(t){var e={};function a(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=t,a.c=e,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var n in t)a.d(s,n,function(e){return t[e]}.bind(null,n));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,\"a\",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p=\"\",a(a.s=0)}([function(t,e,a){Vue.prototype.$eventBus=new Vue;var s,n,o=a(1),i=axios.create({url:\"/\",headers:{\"content-type\":\"application/json\",accept:\"application/json\"}});new Vue({el:\"#app\",template:'<div><component v-bind:is=\"currentPage.component\" @change-page=\"changePage\" :data=\"tasks\"/></div>',data:{pages:o.pages,currentPage:o.pages[\"login-page\"],tasks:[]},created:function(){i.post(\"\",{jsonrpc:\"2.0\",method:\"getHost\",params:{count:2},id:0}).then(t=>{s=axios.create({baseURL:\"http://\"+t.data.result.host[1],headers:{\"content-type\":\"application/json\",accept:\"application/json\"},withCredentials:!0}),n=axios.create({baseURL:\"http://\"+t.data.result.host[0],headers:{\"content-type\":\"application/json\",accept:\"application/json\"},withCredentials:!0}),o.setTaskConnection(s),o.setStateConnection(n)})},methods:{changePage:function(t){if(\"ToMainPage\"===t.name){this.currentPage=this.pages[\"main-page\"];let e={jsonrpc:\"2.0\",method:\"getTasks\",params:{archived:t.archived,filter:t.filter},id:0};s.post(\"\",e).then(t=>{this.tasks=t.data.result.tasks,this.tasks.forEach((e,a,s)=>{e.creation_date=new Date(e.creation_date).toLocaleString().slice(0,10),\"-\"!=t.data.result.states[a].change_date?e.change_date=new Date(t.data.result.states[a].change_date).toLocaleString().slice(0,10):e.change_date=\"-\",0===t.data.result.states[a].state?e.state=\"Не выполнено\":1===t.data.result.states[a].state?e.state=\"Выполнено\":e.state=\"Недоступно\",console.log(e)})})}else\"CreateTask\"===t.name?this.currentPage=this.pages[\"new-task\"]:\"LogInPage\"===t.name?this.currentPage=this.pages[\"login-page\"]:\"SignUpPage\"===t.name?this.currentPage=this.pages[\"signup-page\"]:\"ErrorPage\"===t.name&&(this.currentPage=this.pages[\"error-page\"]);console.log(t,this)},deleteTask:function(t){this.tasks.forEach((e,a,s)=>{e.task_id===t&&this.tasks.splice(a,1)})}},mounted:function(){this.$root.$on(\"conn-lost\",(function(t){\"task\"===t.type?\"http://undefined\"!=t.url?(s=axios.create({baseURL:t.url,headers:{\"content-type\":\"application/json\",accept:\"application/json\"},withCredentials:!0}),o.setTaskConnection(s)):this.changePage({name:\"ErrorPage\"}):\"http://undefined\"!=t.url&&(n=axios.create({baseURL:t.url,headers:{\"content-type\":\"application/json\",accept:\"application/json\"},withCredentials:!0}),o.setStateConnection(n))})),this.$root.$on(\"change-page\",(function(t){this.changePage(t)})),this.$root.$on(\"delete-task\",(function(t){this.deleteTask(t)}))}})},function(t,e,a){var s=a(2),n=a(8),o=a(9),i=a(10),l=a(11);t.exports.pages={\"login-page\":n.component,\"signup-page\":o.component,\"main-page\":s.component,\"new-task\":i.component,\"error-page\":l.component},t.exports.setTaskConnection=function(t){n.setConnection(t),o.setConnection(t),s.setTaskConnection(t),i.setTaskConnection(t)},t.exports.setStateConnection=function(t){s.setStateConnection(t),i.setStateConnection(t)}},function(t,e,a){var s=a(3),n=a(4);t.exports.component={component:{props:[\"data\"],data:function(){return{fileredTasks:[],archived:0}},components:{\"task-filter\":s.component,\"task-table\":n.component},template:'<div style=\"width: 100%;\"><div id=\"header\"><img class=\"dark-logo\" src=\"/dark_logo\"></div><div class=\"body\"><task-filter @apply=\"filterTasks\" :tasks=\"data\" /><div class=\"task-field\"><button class=\"create\" @click=\"createTask\">Создать</button><button class=\"storage\" @click=\"showActive\" v-if=\"archived\">Активные</button><button class=\"storage\" @click=\"showArchived\" v-else>Архив</button><task-table :tasks=\"data\" /></div></div></div>',methods:{createTask:function(){this.$emit(\"change-page\",{name:\"CreateTask\"})},showActive:function(){this.archived=0,this.$emit(\"change-page\",{name:\"ToMainPage\",archived:0})},showArchived:function(){this.archived=1,this.$emit(\"change-page\",{name:\"ToMainPage\",archived:1})},filterTasks:function(t){this.$emit(\"change-page\",{name:\"ToMainPage\",archived:this.archived,filter:t})}}}},t.exports.setTaskConnection=function(t){n.setTaskConnection(t)},t.exports.setStateConnection=function(t){n.setStateConnection(t)}},function(t,e){t.exports.component={props:[\"tasks\"],data:function(){return{withDate:!1,withState:!1,error:\"\",days:[],months:[],years:[],startDay:0,startMonth:0,startYear:0,endDay:0,endMonth:0,endYear:0,state:\"\"}},template:'<div class=\"filter\"><div class=\"title\">Выбрать задания</div><label for=\"date-field\"><input type=\"checkbox\" v-model=\"withDate\" id=\"date-field\" />За период</label><div v-if=\"withDate\"><div>Начало периода</div><select v-model=\"startDay\" :disabled=\"!withDate\"><option disabled value=\"\">День</option><option v-for=\"day in days\" :key=\"day\" :value=\"day\">{{ day }}</option></select><select v-model=\"startMonth\" :disabled=\"!withDate\"><option disabled value=\"\">Месяц</option><option v-for=\"month in months\" :key=\"month.value\" :value=\"month.value\">{{ month.text }}</option></select><select v-model=\"startYear\" :disabled=\"!withDate\"><option disabled value=\"\">Год</option><option v-for=\"year in years\" :key=\"year\" :value=\"year\">{{ year }}</option></select></div><div v-if=\"withDate\"><div>Конец периода</div><select v-model=\"endDay\" :disabled=\"!withDate\"><option disabled value=\"\">День</option><option v-for=\"day in days\" :key=\"day\" :value=\"day\">{{ day }}</option></select><select v-model=\"endMonth\" :disabled=\"!withDate\"><option disabled value=\"\">Месяц</option><option v-for=\"month in months\" :key=\"month.value\" :value=\"month.value\">{{ month.text }}</option></select><select v-model=\"endYear\" :disabled=\"!withDate\"><option disabled value=\"\">Год</option><option v-for=\"year in years\" :key=\"year\" :value=\"year\">{{ year }}</option></select></div><div class=\"error-message\">{{ error }}</div><label for=\"state-field\"><input type=\"checkbox\" v-model=\"withState\" id=\"state-field\" />Со статусом</label><div v-if=\"withState\"><label for=\"done\"><input type=\"radio\" v-model=\"state\" id=\"done\" value=\"1\" :disabled=\"!withState\">Выполненные</label><label for=\"undone\"><input type=\"radio\" v-model=\"state\" id=\"undone\" value=\"0\" :disabled=\"!withState\">Не выполненные</label></div><input type=\"submit\" class=\"submit\" @click=\"apply\" value=\"Выбрать\" /></div>',created:function(){this.months=[{value:1,text:\"января\"},{value:2,text:\"февраля\"},{value:3,text:\"марта\"},{value:4,text:\"апреля\"},{value:5,text:\"мая\"},{value:6,text:\"июня\"},{value:7,text:\"июля\"},{value:8,text:\"августа\"},{value:9,text:\"сентября\"},{value:10,text:\"октября\"},{value:11,text:\"ноября\"},{value:12,text:\"декабря\"}];var t=new Date;for(let t=1;t<=31;t++)this.days.push(t);for(let e=t.getFullYear();e>=2e3;e--)this.years.push(e)},methods:{apply:function(){this.error=\"\";var t={};if(this.withDate)if(this.startDay*this.startMonth*this.startYear==0?t.startDate=\"2000-1-1\":t.startDate=this.startYear+\"-\"+this.startMonth+\"-\"+this.startDay,this.endDay*this.endMonth*this.endYear==0){let e=new Date;t.endDate=e.getFullYear()+\"-\"+(e.getMonth()+1)+\"-\"+e.getDate()}else t.endDate=this.endYear+\"-\"+this.endMonth+\"-\"+this.endDay;this.withState&&\"\"!=this.state&&(t.state=this.state),new Date(t.startDate)>new Date(t.endDate)?this.error=\"Дата начала периода не может быть позже даты окончания\":this.$emit(\"apply\",t)}}}},function(t,e,a){var s=a(5);t.exports.component={props:[\"tasks\"],components:{\"single-task\":s.component},template:'<div class=\"table\"><table><thead><tr><th>Название</th><th style=\"width: 140px;\">Статус</th><th style=\"width: 200px;\">Последнее изменение</th></tr></thead><tbody><single-task v-for=\"task in tasks\" :key=\"task.task_id\" :task=\"task\" /></tbody></table></div>'},t.exports.setTaskConnection=function(t){s.setTaskConnection(t)},t.exports.setStateConnection=function(t){s.setStateConnection(t)}},function(t,e,a){var s=a(6),n=a(7);t.exports.component={props:[\"task\"],data:function(){return{taskView:s.component,active:!1}},template:'<component :is=\"taskView.component\" @change-view=\"changeView\" :task=\"task\" />',methods:{changeView:function(t){this.taskView=\"toActive\"===t?n.component:s.component}}},t.exports.setTaskConnection=function(t){n.setTaskConnection(t)},t.exports.setStateConnection=function(t){n.setStateConnection(t)}},function(t,e){t.exports.component={component:{props:[\"task\"],template:'<tr class=\"closed\" @click=\"changeView\"><td>{{ task.name }}</td><td>{{ task.state }}</td><td>{{ task.change_date }}</td></tr>',methods:{changeView:function(){this.$emit(\"change-view\",\"toActive\")}}}}},function(t,e){var a,s,n=async function(t,e,n){var o=\"task\"===t?a.defaults.baseURL:s.defaults.baseURL,i=axios.create({url:\"/\",headers:{\"content-type\":\"application/json\",accept:\"application/json\"}});let l={jsonrpc:\"2.0\",method:\"removeHost\",params:{type:t,host:o.slice(7)},id:0};var r;return await i.post(\"\",l).then(t=>{o=\"http://\"+t.data.result.host}).catch(t=>{console.log(\"Router unavailable\"),console.log(t)}),console.log(o),\"task\"===t?a.defaults.baseURL=o:s.defaults.baseURL=o,\"http://undefined\"!=o&&await n(e).then(t=>{(r=t).hostChanged=!0}),void 0===r&&(r={hostChanged:!0}),r},o=async function(t){var e={authorized:!1};return await a.post(\"\",{jsonrpc:\"2.0\",method:\"isAuthorized\",params:{},id:0}).then(t=>{null!=t.data.result.authorized&&(e={authorized:t.data.result.authorized},console.log(e))}).catch((async function(s){console.log(s),await n(\"task\",t,o).then(t=>{(e=t).host=a.defaults.baseURL})})),e},i=async function(t){let e=new Date;console.log(\"change\");var a={jsonrpc:\"2.0\",method:\"updateState\",params:{taskId:t.taskId,state:t.state,date:e.getFullYear()+\"-\"+(e.getMonth()+1)+\"-\"+e.getDate()},id:0},o=\"ERROR\";return await s.post(\"\",a).then(t=>{\"OK\"===t.data.result.status&&(o=\"OK\",console.log(o))}).catch((async function(e){console.log(e),await n(\"state\",t,i).then(t=>{(o=t).host=s.defaults.baseURL})})),o};t.exports.component={component:{props:[\"task\"],data:function(){return{btnClass:\"{}\",disabled:!1}},template:'<tr class=\"opened\"><td colspan=\"3\"><div class=\"title subtitle\" @click=\"changeView\">{{ task.name }}</div><button v-if=\"isDone()\" :class=\"btnClass\" @click=\"makeUndone\">Выполнено</button><button v-else :class=\"btnClass\" @click=\"makeDone\">Не выполнено</button><button class=\"create\" @click=\"setArchived\" :disabled=\"disabled\">В архив</button><div><label>Дата создания:</label> {{ task.creation_date }}</div><div><label>Дата изменения:</label> {{ task.change_date }}</div><label>Описание</label><div>{{ task.description }}</div></td></tr>',methods:{changeView:function(){this.$emit(\"change-view\",\"toInactive\")},isDone:function(){return this.btnClass=\"Выполнено\"===this.task.state?\"done\":\"undone\",\"Выполнено\"===this.task.state},makeDone:function(){o().then(t=>{if(t.hostChanged&&this.$eventBus.$emit(\"conn-lost\",{url:a.defaults.baseURL,type:\"task\"}),t.authorized){let t={state:1,taskId:this.task.task_id};i(t).then(t=>{t.hostChanged&&this.$eventBus.$emit(\"conn-lost\",{url:s.defaults.baseURL,type:\"state\"}),this.task.state=\"Выполнено\",this.btnClass=\"done\";var e=new Date;this.task.change_date=e.toLocaleString().slice(0,10)})}else this.$root.$emit(\"change-page\",{name:\"LogInPage\"})})},makeUndone:function(){o().then(t=>{if(t.hostChanged&&this.$eventBus.$emit(\"conn-lost\",{url:a.defaults.baseURL,type:\"task\"}),t.authorized){let t={state:0,taskId:this.task.task_id};i(t).then(t=>{console.log(t),t.hostChanged&&(this.$eventBus.$emit(\"conn-lost\",{url:s.defaults.baseURL,type:\"state\"}),console.log({url:s.defaults.baseURL,type:\"state\"})),this.task.state=\"Не выполнено\",this.btnClass=\"undone\",currDate=new Date,this.task.change_date=currDate.toLocaleString().slice(0,10)})}else this.$root.$emit(\"change-page\",{name:\"LogInPage\"})})},setArchived:function(){o().then(t=>{if(t.hostChanged&&this.$root.$emit(\"conn-lost\",{url:a.defaults.baseURL,type:\"task\"}),t.authorized){let t={jsonrpc:\"2.0\",method:\"setArchived\",params:{taskId:this.task.task_id},id:0};a.post(\"\",t).then(t=>{\"OK\"===t.data.result.status&&this.$root.$emit(\"delete-task\",this.task.task_id)})}else this.$root.$emit(\"change-page\",{name:\"LogInPage\"})})}}}},t.exports.setTaskConnection=function(t){a=t},t.exports.setStateConnection=function(t){s=t}},function(t,e){var a,s=async function(t){let e={jsonrpc:\"2.0\",method:\"logIn\",params:{login:t.login,needSalt:!0},id:0};var n={};return await a.post(\"\",e).then(e=>{if(null!=e.data.result)if(null!=e.data.result.salt){let a=dcodeIO.bcrypt;n.hash=a.hashSync(t.password,e.data.result.salt),n.hash=a.hashSync(n.hash,10)}else n.error=\"Введены неверные данные\"}).catch((async function(e){console.log(e),await async function(t,e,s){var n=\"task\"===t?a.defaults.baseURL:stateServ.defaults.baseURL,o=axios.create({url:\"/\",headers:{\"content-type\":\"application/json\",accept:\"application/json\"}});let i={jsonrpc:\"2.0\",method:\"removeHost\",params:{type:t,host:n.slice(7)},id:0};var l;return await o.post(\"\",i).then(t=>{n=\"http://\"+t.data.result.host}).catch(t=>{console.log(\"Router unavailable\"),console.log(t)}),console.log(n),\"task\"===t?a.defaults.baseURL=n:stateServ.defaults.baseURL=n,\"http://undefined\"!=n&&await s(e).then(t=>{(l=t).hostChanged=!0}),void 0===l&&(l={hostChanged:!0}),l}(\"task\",t,s).then(t=>{(n=t).host=a.defaults.baseURL})})),n};t.exports.component={component:{data:function(){return{error:\"\",login:\"\",password:\"\"}},template:'<div id=\"log-in-page\"><div class=\"login-form\"><img class=\"light-logo\" src=\"/light_logo\"><div class=\"title\">Вход</div><div class=\"form-field\"><label>Логин</label><input class=\"input-field\" type=\"text\" name=\"login\" v-model=\"login\" /></div><div class=\"form-field\"><label>Пароль</label><input class=\"input-field\" type=\"password\" name=\"password\" v-model=\"password\" /></div><div class=\"error-message\">{{ error }}</div><input type=\"submit\" class=\"submit\" value=\"Войти\" @click=\"authorize\" /><input type=\"submit\" class=\"submit\" value=\"Зарегистрироваться\" @click=\"signUp\" /></div></div>',methods:{authorize:function(){this.error=\"\",s({login:this.login,password:this.password}).then(t=>{if(t.hostChanged&&this.$root.$emit(\"conn-lost\",{url:a.defaults.baseURL,type:\"task\"}),null!=t.error)this.error=t.error;else{let e={jsonrpc:\"2.0\",method:\"logIn\",params:{login:this.login,password:t.hash},id:0};a.post(\"\",e).then(t=>{if(null!=t.data.result)if(t.data.result.authorized){let t={name:\"ToMainPage\",archived:0};this.$emit(\"change-page\",t)}else this.error=\"Введены неверные данные\"})}})},signUp:function(){this.$emit(\"change-page\",{name:\"SignUpPage\"})}}}},t.exports.setConnection=function(t){a=t}},function(t,e){var a;t.exports.component={component:{data:function(){return{error:\"\",login:\"\",password:\"\"}},template:'<div id=\"log-in-page\"><div class=\"login-form\"><img class=\"light-logo\" src=\"/light_logo\"><div class=\"title\">Регистрация</div><div class=\"form-field\"><label title=\"Логин должен содержать не менее 6 символов без спецсимволоов\">Логин</label><input title=\"Логин должен содержать не менее 6 символов без спецсимволоов\" class=\"input-field\" type=\"text\" name=\"login\" v-model=\"login\" /></div><div class=\"form-field\"><label title=\"Пароль должен содержать не менее 6 символов\">Пароль</label><input title=\"Пароль должен содержать не менее 6 символов\" class=\"input-field\" type=\"password\" name=\"password\" v-model=\"password\" /></div><div class=\"error-message\">{{ error }}</div><input type=\"submit\" class=\"submit\" value=\"Зарегистрироваться\" @click=\"registrate\" /><input type=\"submit\" class=\"submit\" value=\"Войти\" @click=\"logIn\" /></div></div>',methods:{registrate:function(){if(this.error=\"\",this.login.length<6)return this.error=\"Логин не может быть короче 6 символов\",1;if(this.password.length<6)return this.error=\"Пароль не может быть короче 6 символов\",1;let t={jsonrpc:\"2.0\",method:\"signUp\",params:{login:this.login,password:this.password},id:0};a.post(\"\",t).then(t=>{if(200===t.status&&null!=t.data.result)if(\"OK\"===t.data.result.status){let t={name:\"LogInPage\"};this.$emit(\"change-page\",t)}else\"NOT_UNIQUE\"===t.data.result.status?this.error=\"Пользователь с таким именем уже существует\":this.error=\"В логине используются спецсимволы\"})},logIn:function(){this.$emit(\"change-page\",{name:\"LogInPage\"})}}}},t.exports.setConnection=function(t){a=t}},function(t,e){var a,s,n=async function(t,e,n){var o=\"task\"===t?a.defaults.baseURL:s.defaults.baseURL,i=axios.create({url:\"/\",headers:{\"content-type\":\"application/json\",accept:\"application/json\"}});let l={jsonrpc:\"2.0\",method:\"removeHost\",params:{type:t,host:o.slice(7)},id:0};var r;return await i.post(\"\",l).then(t=>{o=\"http://\"+t.data.result.host}).catch(t=>{console.log(\"Router unavailable\"),console.log(t)}),console.log(o),\"task\"===t?a.defaults.baseURL=o:s.defaults.baseURL=o,\"http://undefined\"!=o&&await n(e).then(t=>{(r=t).hostChanged=!0}),void 0===r&&(r={hostChanged:!0}),r},o=async function(t){var e={authorized:!1};return await a.post(\"\",{jsonrpc:\"2.0\",method:\"isAuthorized\",params:{},id:0}).then(t=>{null!=t.data.result.authorized&&(e={authorized:t.data.result.authorized},console.log(e))}).catch((async function(s){console.log(s),await n(\"task\",t,o).then(t=>{(e=t).host=a.defaults.baseURL})})),e},i=async function(t){let e=new Date;console.log(\"change\");var a={jsonrpc:\"2.0\",method:\"updateState\",params:{taskId:t.taskId,state:t.state,date:e.getFullYear()+\"-\"+(e.getMonth()+1)+\"-\"+e.getDate()},id:0},o=\"ERROR\";return await s.post(\"\",a).then(t=>{\"OK\"===t.data.result.status&&(o=\"OK\",console.log(o))}).catch((async function(e){console.log(e),await n(\"state\",t,i).then(t=>{(o=t).host=s.defaults.baseURL})})),o};t.exports.component={component:{data:function(){return{name:\"\",description:\"\",error:\"\"}},template:'<div><div id=\"header\"><img src=\"/dark_logo\"></div><h2>Создать задание</h2><div><label>Название</label><input type=\"text\" name=\"name\" v-model=\"name\" /></div><div>{{ error }}</div><div><label>Описание</label><input type=\"text\" name=\"description\" v-model=\"description\" maxlenght=\"999\" /></div><button @click=\"emptyCheck\">Создать</button><button @click=\"back\">Назад</button></div>',methods:{back:function(){this.$emit(\"change-page\",{name:\"ToMainPage\",archived:0})},emptyCheck:function(){\"\"===this.name?this.error=\"Название не может быть пустым\":this.create()},create:function(){o().then(t=>{if(t.hostChanged&&this.$root.$emit(\"conn-lost\",{url:a.defaults.baseURL,type:\"task\"}),t.authorized){(async function(t){var e=new Date,s={jsonrpc:\"2.0\",method:\"isExist\",params:{name:t.name,date:e.getFullYear()+\"-\"+(e.getMonth()+1)+\"-\"+e.getDate()},id:0};return await a.post(\"\",s).then(a=>{\"OK\"===a.data.result.status&&(s={jsonrpc:\"2.0\",method:\"createTask\",params:{name:t.name,description:t.description,date:e.getFullYear()+\"-\"+(e.getMonth()+1)+\"-\"+e.getDate()},id:0})}),\"createTask\"===s.method&&await a.post(\"\",s).then(t=>{0!=t.data.result.id&&(s={taskId:t.data.result.id,state:0})}),s})({name:this.name,description:this.description}).then(t=>{null!=t.taskId?i(t).then(t=>{null!=t&&this.$emit(\"change-page\",{name:\"ToMainPage\",archived:0})}):this.error=\"Сегодня уже была создана задача с таким именем\"})}else this.$root.$emit(\"change-page\",{name:\"LogInPage\"})})}}}},t.exports.setTaskConnection=function(t){a=t},t.exports.setStateConnection=function(t){s=t}},function(t,e){t.exports.component={component:{template:\"<div>На сервере ведутся технические работы</div>\"}}}]);","extractedComments":[]}