# Описание API
## Основные сведения
Каждый компонент системы работает с использованием своего API. Взаимодействие клиента с системой построено на основе протокола JSON RPC 2.0 (имеются определённые отступления). Это накладывает определённую структуру запросов и ответов. Обмен данными в этом протоколе происходи за счёт обмена простыми записями, сериализованными в JSON.
### Структура запроса
Запрос состоит из четырёх полей:
- jsonrpc - по умолчанию 2.0, обозначает версию протокола;
- method - имя метода, который должен выполнить сервер;
- params - параметры вызываемого метода;
- id - уникальный идентификатор вызова, по-другому данные, позволяющие идентифицировать каждый запрос (в системе полю id соответствует 0, так как использование batch-запросов не нужно и идентифицировать ответы необходимости нет.
### Структура ответа
- jsonrpc - всегда 2.0;
- result - содержит результат работы вызванной функции;
- error - содержит информацию об ошибке, если она возникла;
- id - как в запросе.
## Методы
### Router
1. getHost - даёт адреса taskService и stateService
    Параметры: 
    - count - количество адресов (1 или 2).
    Ответ:
    - host[] - адреса (count=1 - адрес taskService, count=2 - по адресу каждого сервиса).
2. removeHost - удаляет адрес недоступного сервиса из памяти (изменения в hosts.json не производятся)
    Параметры:
    - type - идентифицирует к какому сервису относится адрес (принимает значения 'task' и 'state');
    - host - адрес, который надо удалить.
    Результат:
    Отсутствует
3. validateHost - проверяет, есть ли этот адрес в списке для taskService (применяется для идентификации taskService при подключении к stateService)
    Параметры:
    -host - адрес, который необходимо проверить.
    Результат:
    - status - OK - принадлежит, ERROR - не принадлежит.
4. Для обновления адресов в памяти сервиса используется адрес: /refresh, это запускает считывание информации из hosts.json.
### TaskService
1. logIn - функция для произведения всего процесса аутентификации
    #### 1-ый шаг
    Параметры:
    - login - имя пользователя;
    - needSalt - флаг, обозначающий первый шаг входа в систему (равен true).
    Результат:
    - salt - соль для первого этапа хэширования пароля (которая использовалась для хэширования пароля при помещении в БД).
    #### 2-ой шаг
    Параметры:
    - login - имя пользователя;
    - password - хэш пароля;
    Результат:
    - authorized - логический флаг входа в систему;
    - userId - уникальный номер пользователя (не передаётся пользователю).
2. getTasks - извлекает задания пользователя из БД
    Параметры:
    - archived - флаг архивации (1 - архивированные, 0 - не архивированные задания);
    - filter - набор данных для фильтрации заданий (необязательный);
    - filter.startDate - начало выбираемого периода в формате YYYY-MM-DD (неможет использоватся без endDate);
    - filter.endDate - конец необходимого периода в формате YYY-MM-DD;
    - filter.state - флаг статуса задания (1 - выполнено, 0 - не выполнено).
3. isExist - проверяет наличие задания с заданным именем, созданного за текущий день
    Параметры:
    - name - название задания;
    - date - дата создания задания.
    Результат:
    - status - EXISTING - существует, добавление невозможно, ОК - не существует, можно добавить.
4. createTask - создаёт задание в списке
    Параметры:
    - name - название задания;
    - description - описание задания;
    - date - дата создания заказа.
    Результат:
    - id - уникальный номер созданного в БД задания (необходим для создания записи в таблицы состояний клиентом).
5. setArchived - устанавливает заданию флаг помещения в архив
    Параметры:
    - taskId - номер задания.
    Результат:
    - status - ERROR - нет задания, ОК - перемещение произведено успешно.
6. signUp - вносит данные пользователя в систему
    Параметры:
    - login - имя пользователя;
    - password - пароль пользователя.
    Результат:
    - status - OK - пользователь создан, NOT_UNIQUE - имя уже занято, WRONG_DATA - использованы запрещённые символы в логине.
### StateService
1. getStates - извлекает данные о состояниях заданий из базы на основании номера задания
    Параметры:
    - taskIds[] - массив номеров заданий, для которых надо извлеч данные;
    Результат:
    - массив объектов вида {task_id, state, change_date}, которые обозначают номер задания, статус, дата последнего изменения соответственно.
2. updateState - добавляет новую запись об изменении статуса задания
    Параметры:
    - taskId - номер задания;
    - state - статус выполнения;
    - date - дата создания задания.
    Результат:
    - status - ОК - задача добавлена, ERROR - придобавлении произошла ошибка.
